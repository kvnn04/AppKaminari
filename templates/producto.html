{% extends "base.html" %}

{% block title %}
Producto Page
{% endblock %}

{% block header %}
    <a class="navbar-brand" href="{{ url_for('home') }}">KHANTANI</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            
        </ul>
        <div class="d-flex">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Cuenta
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{{ url_for('signUp.register') }}">Register</a></li>
                        
                        {% if session.get('informationUsuario') %}
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('logOut.logout') }}">LogOut</a></li>
                        {% else %}

                        <li><a class="dropdown-item" href="{{ url_for('signIn.iniciarSesion') }}">SignIn</a></li>
                        {% endif %}
                    </ul>
                </li>
                <li class="nav-item"><a class="nav-link" href="#footer">Contacto</a></li>
                <li class="nav-item"><a class="nav-link" href="{{ url_for('carrito.carritoPage')}}">Carrito</a></li>
            </ul>
        </div>
    </div>
{% endblock %}

{% block content %}

{% if producto %}
<div class="container py-5">
    <div class="row g-5">
        <div class="col-lg-7">
            <div id="productCarousel" class="carousel slide carousel-fade shadow-sm rounded bg-white">
                <div class="carousel-inner">
                    {% if producto['imagenes'] %}
                        {% for imagen in producto['imagenes'] %}
                        <div class="carousel-item {{ 'active' if loop.first }}">
                            <img src="{{imagen}}" class="d-block w-100 rounded" alt="Producto" style="height: 600px; object-fit: cover;">
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="carousel-item active">
                            <img src="https://via.placeholder.com/600x600" class="d-block w-100 rounded" alt="Placeholder">
                        </div>
                    {% endif %}
                </div>
                
                {% if producto['imagenes']|length > 1 %}
                <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon bg-dark rounded-circle" aria-hidden="true"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon bg-dark rounded-circle" aria-hidden="true"></span>
                </button>
                {% endif %}
            </div>
            
            <div class="mt-5">
                <h4 class="fw-bold border-bottom pb-2">Descripción del Producto</h4>
                <p class="text-secondary mt-3" style="line-height: 1.8;">
                    {{ producto['descripcion'] }}
                </p>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="sticky-top" style="top: 2rem;">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-2">
                        <li class="breadcrumb-item"><a href="/" class="text-decoration-none text-muted small">Inicio</a></li>
                        <li class="breadcrumb-item active small" aria-current="page">Producto</li>
                    </ol>
                </nav>
                
                <h1 class="fw-bold display-5 mb-3">{{producto['nombre']}}</h1>
                <h2 class="text-primary fw-bold mb-4">${{ "{:,.2f}".format(producto['precio']) }}</h2>

                {% if dataProducto %}
                <form class="bg-light p-4 rounded shadow-sm">
                    <div class="mb-4">
                        <label class="form-label fw-bold small text-uppercase">Talle seleccionado: <span class="text-primary">{{dataProducto['talleParams']}}</span></label>
                        <div class="d-flex flex-wrap gap-2">
                            {% for variante in dataProducto['colorYTalleDisponiblesByProductos']['talleDisponible'] %}
                                <a href="{{ url_for('producto.productoPage', id=dataProducto['id'], talleParams=variante) }}" 
                                   class="btn btn-sm {{ 'btn-dark' if dataProducto['talleParams'] == variante else 'btn-outline-dark' }} px-3">
                                   {{variante}}
                                </a>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold small text-uppercase">Color disponible para este talle:</label>
                        <div class="d-flex flex-wrap gap-2">
                            {% for variante in dataProducto['colorYTalleDisponiblesByProductos']['coloresTalleActual'] %}
                                <a href="{{ url_for('producto.productoPage', id=dataProducto['id'], talleParams=dataProducto['talleParams'], colorParams=variante, cantidadParams=1) }}" 
                                   class="btn btn-sm {{ 'btn-primary' if dataProducto['colorParams'] == variante else 'btn-outline-secondary' }}">
                                   {{variante}}
                                </a>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold small text-uppercase">Cantidad:</label>
                        <select class="form-select w-50" onchange="location = this.value;">
                            {% for v in dataProducto['cantidadDisponible'] %}
                                <option value="{{ url_for('producto.productoPage', id=dataProducto['id'], talleParams=dataProducto['talleParams'], colorParams=dataProducto['colorParams'], cantidadParams=v) }}" 
                                        {{ 'selected' if dataProducto['cantidadParams'] | int == v|int }}>{{ v }} unidades
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="d-grid gap-3 pt-2">
                        <a href="{{ url_for('carrito.agregarProductoACarrito', id=dataProducto['id'], nombre=dataProducto['nombreProducto'], talle=dataProducto['talleParams'], color=dataProducto['colorParams'], cantidad=dataProducto['cantidadParams'], precio=dataProducto['precio']) }}" 
                           class="btn btn-outline-dark btn-lg py-3 fw-bold">
                           <i class="bi bi-cart-plus me-2"></i> Agregar al carrito
                        </a>
                        <a href="{{ url_for('pagoProducto.pagos', id=dataProducto['id'], cantidad=dataProducto['cantidadParams']) }}" 
                           class="btn btn-warning btn-lg py-3 fw-bold">
                           Comprar ahora
                        </a>
                    </div>
                </form>
                {% else %}
                <div class="alert alert-warning border-0 shadow-sm mt-4">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i> No hay stock disponible de este producto por el momento.
                </div>
                {% endif %}

                <div class="mt-4 border-top pt-4">
                    <div class="d-flex align-items-center mb-3">
                        <i class="bi bi-truck fs-4 me-3 text-secondary"></i>
                        <span class="small">Envío gratis en compras superiores a $50.000</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-arrow-repeat fs-4 me-3 text-secondary"></i>
                        <span class="small">Cambios y devoluciones gratis por 30 días</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}